<div class="admin-container">
  <div class="container-fluid py-5">
    <div class="admin-header d-flex justify-content-between align-items-center mb-4">
      <h1>Панель адміністратора</h1>
      <button class="btn btn-outline-danger" (click)="logout()">
        <i class="fas fa-sign-out-alt me-2"></i>Вийти
      </button>
    </div>

    <!-- Notification -->
    <div *ngIf="message" class="alert alert-{{ messageType }} alert-dismissible fade show" role="alert">
      {{ message }}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close" (click)="message = ''"></button>
    </div>
    
    <div class="row">
      <!-- Add Book Form -->
      <div class="col-lg-4 mb-4">
        <div class="card">
          <div class="card-header bg-primary text-white">
            <h2 class="h5 mb-0">Додати нову книгу</h2>
          </div>
          <div class="card-body">
            <form (ngSubmit)="onSubmit()" #bookForm="ngForm">
              <div class="row g-3">
                <div class="col-12">
                  <label for="title" class="form-label">Назва*</label>
                  <input 
                    type="text" 
                    class="form-control" 
                    id="title" 
                    name="title"
                    [(ngModel)]="newBook.title" 
                    required>
                </div>
                
                <div class="col-12">
                  <label for="author" class="form-label">Автор*</label>
                  <input 
                    type="text" 
                    class="form-control" 
                    id="author" 
                    name="author"
                    [(ngModel)]="newBook.author" 
                    required>
                </div>
                
                <div class="col-md-6">
                  <label for="yearPublished" class="form-label">Рік видання</label>
                  <input 
                    type="number" 
                    class="form-control" 
                    id="yearPublished" 
                    name="yearPublished"
                    [(ngModel)]="newBook.yearPublished">
                </div>
                
                <div class="col-md-6">
                  <label for="language" class="form-label">Мова</label>
                  <input 
                    type="text" 
                    class="form-control" 
                    id="language" 
                    name="language"
                    [(ngModel)]="newBook.language">
                </div>
                
                <div class="col-md-6">
                  <label for="publisher" class="form-label">Видавництво</label>
                  <input 
                    type="text" 
                    class="form-control" 
                    id="publisher" 
                    name="publisher"
                    [(ngModel)]="newBook.publisher">
                </div>
                
                <div class="col-md-6">
                  <label for="pageCount" class="form-label">Кількість сторінок</label>
                  <input 
                    type="number" 
                    class="form-control" 
                    id="pageCount" 
                    name="pageCount"
                    [(ngModel)]="newBook.pageCount">
                </div>
                
                <div class="col-12">
                  <label for="coverImage" class="form-label">URL обкладинки*</label>
                  <input 
                    type="text" 
                    class="form-control" 
                    id="coverImage" 
                    name="coverImage"
                    [(ngModel)]="newBook.coverImage" 
                    required>
                </div>
                
                <div class="col-12">
                  <label for="description" class="form-label">Опис*</label>
                  <textarea 
                    class="form-control" 
                    id="description" 
                    name="description"
                    rows="5"
                    [(ngModel)]="newBook.description" 
                    required></textarea>
                </div>
                
                <div class="col-12">
                  <label for="bookText" class="form-label">Текст книги (завантажити файл)</label>
                  <div class="custom-file-upload">
                    <input 
                      type="file" 
                      class="form-control" 
                      id="bookText"
                      (change)="onFileSelected($event)"
                      accept=".txt">
                    <div class="form-text" *ngIf="!fileSelected">
                      Виберіть текстовий файл з текстом книги для завантаження.
                    </div>
                    <div class="form-text text-success" *ngIf="fileSelected">
                      <i class="fas fa-check-circle me-1"></i> Файл вибрано: {{ selectedFileName }}
                    </div>
                  </div>
                </div>
                
                <div class="col-12">
                  <label class="form-label">Жанри*</label>
                  <div class="genres-container border rounded p-3">
                    <div class="row g-2">
                      <div class="col-6" *ngFor="let genre of genres">
                        <div class="form-check">
                          <input 
                            type="checkbox" 
                            class="form-check-input" 
                            [id]="'genre' + genre.id" 
                            [checked]="selectedGenres.includes(genre.id)"
                            (change)="onGenreChange(genre.id, $event)">
                          <label class="form-check-label" [for]="'genre' + genre.id">{{ genre.name }}</label>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                
                <div class="col-12">
                  <button type="submit" class="btn btn-primary w-100">
                    <i class="fas fa-plus-circle me-2"></i>Додати книгу
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
      
      <!-- Books Table -->
      <div class="col-lg-8">
        <div class="card">
          <div class="card-header bg-primary text-white">
            <h2 class="h5 mb-0">Управління книгами</h2>
          </div>
          <div class="card-body p-0">
            <div class="table-responsive">
              <table class="table table-hover mb-0">
                <thead class="table-light">
                  <tr>
                    <th scope="col">#</th>
                    <th scope="col">Назва</th>
                    <th scope="col">Автор</th>
                    <th scope="col">Жанри</th>
                    <th scope="col">Рік</th>
                    <th scope="col">Дії</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let book of books; let i = index">
                    <td>{{ i + 1 }}</td>
                    <td>{{ book.title }}</td>
                    <td>{{ book.author }}</td>
                    <td>
                      <span class="badge bg-secondary me-1" *ngFor="let genre of book.genres">
                        {{ genre.name }}
                      </span>
                    </td>
                    <td>{{ book.yearPublished }}</td>
                    <td>
                      <div class="btn-group btn-group-sm">
                        <a [routerLink]="['/book', book.id]" class="btn btn-info">
                          <i class="fas fa-eye"></i>
                        </a>
                        <button (click)="deleteBook(book.id)" class="btn btn-danger">
                          <i class="fas fa-trash"></i>
                        </button>
                      </div>
                    </td>
                  </tr>
                  <tr *ngIf="books.length === 0">
                    <td colspan="6" class="text-center py-3">Немає книг у базі даних</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
